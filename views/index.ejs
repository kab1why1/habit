<% 
  const habits = (locals && locals.habits) ? locals.habits : [];
  const user = (locals && locals.user) ? locals.user : null;
%>

<main>
  <section class="stats-grid">
    <div class="card">
      <h3>Total Habits</h3>
      <p class="value"><%= habits.length %></p>
    </div>
    <div class="card">
      <h3>Today's Progress</h3>
      <p class="value">0/0</p>
    </div>
    <div class="card">
      <h3>Best Streak</h3>
      <p class="value">0 days</p>
    </div>
    <div class="card">
      <h3>Total Completions</h3>
      <p class="value">1</p>
    </div>
  </section>

  <section class="week">
    <h2>This Week</h2>
    <div class="week-days">
      <!-- static for now, can be generated later -->
    </div>
  </section>

  <section class="today-habits">
    <% if (!user) { %>
      <div class="empty-icon">ðŸŽ¯</div>
      <h3>Welcome â€” please <a href="/register">register</a> or <a href="/login">login</a> to manage habits</h3>

    <% } else if (habits.length === 0) { %>

      <div class="empty-icon">ðŸŽ¯</div>
      <h3>No habits yet</h3>
      <p>Create your first habit to start your journey</p>
      <a href="/habits/new" class="create-btn">+ Create Your First Habit</a>

    <% } else { %>

      <div class="habit-list">
        <% habits.forEach(h => { 
             const color = h.color || '#5b4ef5';
             const category = h.category || 'General';
        %>
          <div class="card habit-card" style="border-left: 6px solid" <%= color %>;">
            <h4>
              <a href="/habits/<%= h.id %>"><%= h.title %></a>
              <% if (h.completed) { %>
                <span class="completed-badge">âœ”</span>
              <% } %>
            </h4>

            <p class="small"><strong>Category:</strong> <%= category %></p>
            <p><%= h.description ? h.description.slice(0, 200) : '' %></p>

            <div class="habit-actions">
              <form action="/habits/<%= h.id %>/toggle" method="POST" style="display:inline;">
                <button type="submit" class="btn small-btn">
                  <%= h.completed ? 'Undo' : 'Complete' %>
                </button>
              </form>

              <a href="/habits/<%= h.id %>/edit" class="btn small-btn">Edit</a>
            </div>
          </div>
        <% }) %>
      </div>

    <% } %>
  </section>
</main>
